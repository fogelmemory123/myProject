<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>גלגל המזל של בית הקפה</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Heebo', sans-serif; background-color: #f5f0ea; color: #5d4037; text-align: center; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; color: #5d4037; }
        p  { font-size: 1.1rem; margin-bottom: 20px; color: #8d6e63; }
        .wheel-container { position: relative; width: 380px; height: 380px; margin: 20px auto; }
        #wheelCanvas { border-radius: 50%; box-shadow: 0 0 20px rgba(0,0,0,0.15); background-color: white; display: block; margin: auto; border: 8px solid #e0c9a6; }
        .wheel-pointer { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; z-index: 100; }
        .wheel-pointer::before { content: ''; position: absolute; top: 0; left: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-top: 50px solid #5d4037; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }
        #spinBtn { background: linear-gradient(to bottom, #d4a762, #b78a3a); color: white; font-size: 1.2rem; font-weight: bold; padding: 15px 40px; border: none; border-radius: 50px; cursor: pointer; margin: 25px 0; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); text-shadow:1px 1px 2px rgba(0,0,0,0.2); }
        #spinBtn:hover { transform: translateY(-3px); }
        #spinBtn:disabled { background: #ccc; cursor: not-allowed; }
        .result-box { background-color: white; border-radius: 15px; padding: 25px; margin-top: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 400px; width: 100%; display: none; border: 2px dashed #d4a762; position: relative; }
        .result-box.fireworks { animation: fireworksGlow 1s ease-out infinite; }
        .result-box h2 { color: #5d4037; margin-bottom:15px; font-size:1.5rem; }
        .result-box p  { color: #c75f3e; font-size:1.5rem; font-weight:bold; margin:0; }
        @keyframes fireworksGlow { 0% { box-shadow: 0 0 10px 5px rgba(255,223,0,0.8); } 50% { box-shadow: 0 0 20px 10px rgba(255,69,0,0.8); } 100% { box-shadow: 0 0 10px 5px rgba(255,223,0,0); } }
        @media(max-width:500px) { .wheel-container { width:320px; height:320px; } #wheelCanvas { width:320px; height:320px; } }
    </style>
</head>
<body>
    <h1>גלגל המזל של בית הקפה</h1>
    <p>סובב את הגלגל וזכה בהנחות מיוחדות!</p>
    <div class="wheel-container">
        <div class="wheel-pointer"></div>
        <canvas id="wheelCanvas" width="380" height="380"></canvas>
    </div>
    <button id="spinBtn">סובב את הגלגל</button>
    <div id="resultBox" class="result-box">
        <h2>ברכות! זכית ב:</h2>
        <p id="resultText"></p>
    </div>
    <script>
        const items = [
            { name: "קפה הפוך", discount: "15%", color: "#e74c3c", icon: "☕" },
            { name: "אספרסו", discount: "10%", color: "#3498db", icon: "⚡" },
            { name: "קפוצ'ינו", discount: "20%", color: "#2ecc71", icon: "🌊" },
            { name: "עוגת שוקולד", discount: "25%", color: "#f39c12", icon: "🍰" },
            { name: "קרואסון", discount: "30%", color: "#9b59b6", icon: "🥐" },
            { name: "סלט", discount: "15%", color: "#1abc9c", icon: "🥗" },
            { name: "מאפה בוקר", discount: "20%", color: "#d35400", icon: "🥖" },
            { name: "מיץ טבעי", discount: "10%", color: "#c0392b", icon: "🍹" }
        ];
        const canvas = document.getElementById('wheelCanvas');
        const ctx    = canvas.getContext('2d');
        let canvasWidth  = canvas.width;
        let canvasHeight = canvas.height;
        let centerX      = canvasWidth / 2;
        let centerY      = canvasHeight / 2;
        let outerRadius  = Math.min(canvasWidth, canvasHeight) / 2 - 8;
        let currentAngle = 0;
        let isSpinning   = false;

        function calculateFontSize() {
            return Math.max(12, Math.floor(outerRadius / 12));
        }

        function drawWheel() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            const numItems     = items.length;
            const anglePerItem = (2 * Math.PI) / numItems;
            ctx.save(); ctx.translate(centerX, centerY); ctx.rotate(currentAngle);

            const fontSize   = calculateFontSize();
            const textRadius = outerRadius * 0.65;

            items.forEach((item, i) => {
                const startAngle = i * anglePerItem;
                const midAngle   = startAngle + anglePerItem / 2;
                ctx.beginPath();
                ctx.moveTo(0,0);
                ctx.lineTo(outerRadius*Math.cos(startAngle), outerRadius*Math.sin(startAngle));
                ctx.lineTo(outerRadius*Math.cos(startAngle+anglePerItem), outerRadius*Math.sin(startAngle+anglePerItem));
                ctx.closePath(); ctx.fillStyle=item.color; ctx.fill();
                ctx.beginPath(); ctx.strokeStyle='#fff'; ctx.lineWidth=3;
                ctx.moveTo(0,0); ctx.lineTo(outerRadius*Math.cos(startAngle), outerRadius*Math.sin(startAngle)); ctx.stroke();
                ctx.save(); ctx.rotate(midAngle); ctx.translate(textRadius,0); ctx.rotate(-midAngle);
                ctx.fillStyle='#fff'; ctx.font=`${fontSize}px Arial`;
                ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(item.icon,0,-fontSize);
                ctx.font=`bold ${fontSize}px Heebo`; ctx.fillText(item.name,0,fontSize*0.2);
                ctx.font=`bold ${fontSize*1.2}px Heebo`; ctx.fillText(item.discount+' הנחה',0,fontSize*1.5);
                ctx.restore();
            });

            ctx.beginPath(); ctx.fillStyle='#5d4037'; ctx.arc(0,0,outerRadius*0.1,0,2*Math.PI); ctx.fill();
            ctx.beginPath(); ctx.strokeStyle='#5d4037'; ctx.lineWidth=8; ctx.arc(0,0,outerRadius,0,2*Math.PI); ctx.stroke(); ctx.restore();
        }

        function spinWheel() {
            if(isSpinning) return; isSpinning=true; document.getElementById('spinBtn').disabled=true;
            const extra = Math.random()*2*Math.PI;
            const target= currentAngle+2*Math.PI*5+extra;
            const dur   = 3000+Math.random()*2000;
            const start = Date.now(), from=currentAngle;
            (function anim(){ const t=(Date.now()-start)/dur;
                if(t<1){ currentAngle=from+(target-from)*(1-Math.pow(1-t,3)); drawWheel(); requestAnimationFrame(anim); }
                else{ currentAngle=target%(2*Math.PI); drawWheel(); isSpinning=false; document.getElementById('spinBtn').disabled=false; showResult(); }
            })();
        }

        function showResult() {
            const norm = (currentAngle%(2*Math.PI)+2*Math.PI)%(2*Math.PI);
            const seg  = 2*Math.PI/items.length;
            const idx  = Math.floor(((1.5*Math.PI)-norm+2*Math.PI)%(2*Math.PI)/seg);
            const win  = items[idx];
            const box  = document.getElementById('resultBox');
            document.getElementById('resultText').innerHTML = `${win.icon} ${win.name} - ${win.discount} הנחה`;
            box.classList.add('fireworks');
            box.style.display = 'block';
            box.scrollIntoView({ behavior: 'smooth', block: 'center' });
            setTimeout(()=> box.classList.remove('fireworks'), 3000);
        }

        document.getElementById('spinBtn').addEventListener('click', spinWheel);
        window.addEventListener('resize', ()=>{
            canvasWidth  = canvas.parentElement.clientWidth;
            canvasHeight = canvasWidth;
            canvas.width  = canvasWidth; canvas.height=canvasHeight;
            centerX     = canvasWidth/2; centerY=canvasHeight/2;
            outerRadius = Math.min(canvasWidth,canvasHeight)/2 -8;
            drawWheel();
        });
        drawWheel();
    </script>
</body>
</html>