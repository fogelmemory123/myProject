<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>משחק זיכרון - שמות ופנים</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap JS Bundle (כולל Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4cc9f0;
      --dark-color: #1a1a2e;
      --light-color: #f8f9fa;
      --success-color: #4caf50;
      --danger-color: #f44336;
      --warning-color: #ff9800;
    }
    
    body {
      font-family: 'Heebo', sans-serif;
      background: linear-gradient(135deg, var(--dark-color), var(--secondary-color));
      color: white;
      text-align: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    h1 {
      margin: 20px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .card {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      color: black;
      transition: all 0.3s ease;
      height: 100%;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }
    
    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-bottom: 1px solid #eee;
    }
    
    .card-body {
      padding: 15px;
    }
    
    .form-select, .btn {
      margin: 0.5rem;
      border-radius: 50px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .btn-success {
      background-color: var(--success-color);
      border-color: var(--success-color);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      border-color: var(--danger-color);
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      border-color: var(--warning-color);
    }
    
    .timer-display {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 20px 0;
      color: var(--accent-color);
    }
    
    .controls {
      margin: 20px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }
    
    .correct {
      border: 3px solid var(--success-color);
    }
    
    .incorrect {
      border: 3px solid var(--danger-color);
    }
    
    .result-display {
      font-size: 1.2rem;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: var(--accent-color);
      opacity: 0;
      z-index: 1000;
      animation: confetti-fall 3s ease-in-out forwards;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    @media (max-width: 768px) {
      .card img {
        height: 150px;
      }
    }
  </style>
</head>
<body>
    <nav class="navbar navbar-light bg-light shadow-sm">
    <div class="container-fluid justify-content-between">
      <span class="navbar-brand">🧠 חדר כושר למוח</span>
    </div>
  </nav>

  <!-- HERO -->
  <div class="game-container">
    <h1><i class="bi bi-people-fill"></i> משחק זיכרון: שמות ופנים</h1>
    
    <div id="setupPhase">
      <div class="controls">
        <div class="mb-3">
          <label class="form-label">מספר זוגות:</label>
          <select id="numFaces" class="form-select d-inline-block w-auto">
            <option value="4">4</option>
            <option value="6">6</option>
            <option value="8" selected>8</option>
            <option value="10">10</option>
            <option value="12">12</option>
          </select>
        </div>
        
        <div class="mb-3">
          <label class="form-label">משך שינון (בשניות):</label>
          <select id="memorizeTime" class="form-select d-inline-block w-auto">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="30">30</option>
            <option value="60" selected>60</option>
            <option value="90">90</option>
            <option value="120">120</option>
          </select>
        </div>
        
        <button onclick="startGame()" class="btn btn-primary">
          <i class="bi bi-play-fill"></i> התחל משחק
        </button>
      </div>
    </div>
    
    <div id="memorizePhase" style="display:none;">
      <h2>שלב השינון</h2>
      <div class="timer-display" id="memorizeTimer"></div>
      <div class="row g-4 justify-content-center" id="memorizeCards"></div>
      
      <div class="controls">
        <button onclick="skipToRecall()" class="btn btn-warning">
          <i class="bi bi-fast-forward-fill"></i> דלג לשלב הזיכרון
        </button>
      </div>
    </div>
    
    <div id="recallPhase" style="display:none;">
      <h2>שלב הזיכרון</h2>
      <div class="timer-display" id="recallTimer"></div>
      <div class="row g-4 justify-content-center" id="recallCards"></div>
      
      <div class="controls">
        <button onclick="checkAnswers()" class="btn btn-success">
          <i class="bi bi-check-circle-fill"></i> סיים ובדוק תשובות
        </button>
        <button onclick="cancelGame()" class="btn btn-danger">
          <i class="bi bi-x-circle-fill"></i> בטל משחק
        </button>
      </div>
    </div>
    
    <div id="resultPhase" style="display:none;">
      <h2>תוצאות המשחק</h2>
      <div class="result-display">
        <p id="scoreDisplay"></p>
        <p id="bestScoreDisplay"></p>
      </div>
      <div class="row g-4 justify-content-center" id="resultCards"></div>
      
      <div class="controls">
        <button onclick="startNewGame()" class="btn btn-primary">
          <i class="bi bi-arrow-repeat"></i> משחק חדש
        </button>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 fogelmemory - כל הזכויות שמורות</p>
  </footer>

  <script>
    // נתוני המשחק
    const maleNames = ["יוסף", "אברהם", "דוד", "משה", "ניר", "גיל", "איתן", "אורי", "אופיר", "אלון", "גיא", "דן", "טל", "יואב", "יניב", "לירן", "נדב", "עידו", "פלג", "צבי"];
    const femaleNames = ["נועה", "יעל", "שירה", "תמר", "עדן", "מאיה", "אדל", "אביגיל", "דנה", "ליה", "נטע", "אילה", "אלונה", "גילי", "הילה", "טליה", "יהלי", "כרמי", "ליאל", "מיה"];
    let pairs = [];
    let currentGame = {
      timeLeft: 0,
      timer: null,
      score: 0,
      bestScore: localStorage.getItem('memoryGameBestScore') || 0
    };

    // פונקציות עזר
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getRandomUserImage(gender, index) {
      const g = gender === 'male' ? 'men' : 'women';
      return `https://randomuser.me/api/portraits/${g}/${index % 100}.jpg`;
    }

    function createConfetti() {
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = `${Math.random() * 100}vw`;
        confetti.style.backgroundColor = getRandomColor();
        confetti.style.width = `${Math.random() * 10 + 5}px`;
        confetti.style.height = `${Math.random() * 10 + 5}px`;
        confetti.style.animationDuration = `${Math.random() * 2 + 1}s`;
        document.body.appendChild(confetti);
        
        setTimeout(() => {
          confetti.remove();
        }, 3000);
      }
    }

    function getRandomColor() {
      const colors = ['#4cc9f0', '#4361ee', '#3f37c9', '#4895ef', '#7209b7'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // פונקציות משחק
    function generatePairs(count) {
      pairs = [];
      const usedNames = new Set();
      
      for (let i = 0; i < count; i++) {
        const isMale = Math.random() < 0.5;
        const nameList = isMale ? maleNames : femaleNames;
        let name;
        
        do {
          name = nameList[getRandomInt(0, nameList.length - 1)];
        } while (usedNames.has(name));
        
        usedNames.add(name);
        
        pairs.push({
          name: name,
          gender: isMale ? 'male' : 'female',
          imageUrl: getRandomUserImage(isMale ? 'male' : 'female', i),
          userAnswer: '',
          isCorrect: false
        });
      }
      
      // ערבוב הזוגות
      shuffleArray(pairs);
    }

    function startGame() {
      const count = parseInt(document.getElementById("numFaces").value);
      const memorizeTime = parseInt(document.getElementById("memorizeTime").value);
      
      generatePairs(count);
      displayMemorizePhase();
      
      // הפעלת טיימר שינון
      startTimer('memorizeTimer', memorizeTime, () => {
        displayRecallPhase();
      });
    }

    function displayMemorizePhase() {
      document.getElementById("setupPhase").style.display = 'none';
      document.getElementById("recallPhase").style.display = 'none';
      document.getElementById("resultPhase").style.display = 'none';
      
      const container = document.getElementById("memorizeCards");
      container.innerHTML = '';
      
      pairs.forEach((pair, index) => {
        container.innerHTML += `
          <div class="col-6 col-md-4 col-lg-3">
            <div class="card">
              <img src="${pair.imageUrl}" alt="${pair.name}">
              <div class="card-body">
                <h5>${pair.name}</h5>
              </div>
            </div>
          </div>
        `;
      });
      
      document.getElementById("memorizePhase").style.display = 'block';
    }

    function displayRecallPhase() {
      clearTimer();
      
      document.getElementById("memorizePhase").style.display = 'none';
      document.getElementById("resultPhase").style.display = 'none';
      
      const container = document.getElementById("recallCards");
      container.innerHTML = '';
      
      // ערבוב נוסף לפני הצגת הפנים
      shuffleArray(pairs);
      
      pairs.forEach((pair, index) => {
        container.innerHTML += `
          <div class="col-6 col-md-4 col-lg-3">
            <div class="card">
              <img src="${pair.imageUrl}" alt="תמונה">
              <div class="card-body">
                <input type="text" data-index="${index}" 
                       placeholder="מה השם?" 
                       class="form-control recall-input">
              </div>
            </div>
          </div>
        `;
      });
      
      document.getElementById("recallPhase").style.display = 'block';
      
      // הפעלת טיימר זיכרון
      startTimer('recallTimer', 120, () => {
        checkAnswers();
      });
    }

    function checkAnswers() {
      clearTimer();
      
      const inputs = document.querySelectorAll('.recall-input');
      let correctCount = 0;
      
      inputs.forEach(input => {
        const index = input.dataset.index;
        const userAnswer = input.value.trim();
        const correctName = pairs[index].name;
        
        pairs[index].userAnswer = userAnswer;
        pairs[index].isCorrect = userAnswer.toLowerCase() === correctName.toLowerCase();
        
        if (pairs[index].isCorrect) {
          correctCount++;
        }
      });
      
      currentGame.score = Math.round((correctCount / pairs.length) * 100);
      
      // בדיקה אם זה שיא חדש
      if (currentGame.score > currentGame.bestScore) {
        currentGame.bestScore = currentGame.score;
        localStorage.setItem('memoryGameBestScore', currentGame.bestScore);
        createConfetti();
      }
      
      displayResults();
    }

    function displayResults() {
      document.getElementById("recallPhase").style.display = 'none';
      
      const container = document.getElementById("resultCards");
      container.innerHTML = '';
      
      pairs.forEach((pair, index) => {
        const cardClass = pair.isCorrect ? 'correct' : 'incorrect';
        const resultIcon = pair.isCorrect ? 
          '<i class="bi bi-check-circle-fill text-success"></i>' : 
          '<i class="bi bi-x-circle-fill text-danger"></i>';
        
        container.innerHTML += `
          <div class="col-6 col-md-4 col-lg-3">
            <div class="card ${cardClass}">
              <img src="${pair.imageUrl}" alt="${pair.name}">
              <div class="card-body">
                <h5>${pair.name}</h5>
                <p>תשובתך: ${pair.userAnswer || '---'}</p>
                <div>${resultIcon}</div>
              </div>
            </div>
          </div>
        `;
      });
      
      document.getElementById("scoreDisplay").innerHTML = `
        <strong>ציון:</strong> ${currentGame.score}% (${pairs.filter(p => p.isCorrect).length}/${pairs.length} תשובות נכונות)
      `;
      
      document.getElementById("bestScoreDisplay").innerHTML = `
        <strong>השיא האישי שלך:</strong> ${currentGame.bestScore}%
      `;
      
      document.getElementById("resultPhase").style.display = 'block';
    }

    // פונקציות טיימר
    function startTimer(elementId, seconds, callback) {
      clearTimer();
      
      const timerElement = document.getElementById(elementId);
      currentGame.timeLeft = seconds;
      
      updateTimerDisplay(timerElement);
      
      currentGame.timer = setInterval(() => {
        currentGame.timeLeft--;
        updateTimerDisplay(timerElement);
        
        if (currentGame.timeLeft <= 0) {
          clearTimer();
          callback();
        }
      }, 1000);
    }

    function updateTimerDisplay(element) {
      const minutes = Math.floor(currentGame.timeLeft / 60);
      const seconds = currentGame.timeLeft % 60;
      element.textContent = `זמן נותר: ${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      // שינוי צבע כשהזמן אוזל
      if (currentGame.timeLeft <= 10) {
        element.style.color = 'var(--danger-color)';
      } else if (currentGame.timeLeft <= 30) {
        element.style.color = 'var(--warning-color)';
      } else {
        element.style.color = 'var(--accent-color)';
      }
    }

    function clearTimer() {
      if (currentGame.timer) {
        clearInterval(currentGame.timer);
        currentGame.timer = null;
      }
    }

    // פונקציות ניווט
    function skipToRecall() {
      clearTimer();
      displayRecallPhase();
    }

    function cancelGame() {
      clearTimer();
      document.getElementById("setupPhase").style.display = 'block';
      document.getElementById("recallPhase").style.display = 'none';
    }

    function startNewGame() {
      document.getElementById("resultPhase").style.display = 'none';
      document.getElementById("setupPhase").style.display = 'block';
    }
  </script>
</body>
</html>